<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>SQL.js 간단 테스트</title>
</head>
<body>
  <h1>sql.js 간단 테스트</h1>
  <p>아래에 SQLite 쿼리 결과가 표시됩니다.</p>

  <div id="results"></div>

  <!-- sql.js (혹은 sql-wasm.js) 로컬 파일 로드 -->
  <script src="sql-wasm.js"></script>

  <script>
    (async () => {
      // 1) sql.js 초기화
      //    locateFile: sql-wasm.wasm 파일 경로 지정
      const SQL = await initSqlJs({
        locateFile: file => file
      });

      // 2) 인메모리 DB 생성
      const db = new SQL.Database();

      // 3) 테이블 생성
      db.run(`
        CREATE TABLE employees (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          name TEXT,
          position TEXT
        );
      `);

      // 4) 데이터 삽입
      //    파라미터 바인딩(?, ?) 형식으로 간단히 예시
      db.run(`
        INSERT INTO employees (name, position)
        VALUES (?, ?), (?, ?);
      `, [
        "Alice", "Engineer",
        "Bob",   "Designer"
      ]);

      // 5) SELECT 쿼리 실행
      const stmt = db.prepare("SELECT * FROM employees;");

      // 6) 결과를 테이블 형태로 표시
      let html = "<table border='1' cellpadding='6' style='border-collapse: collapse;'>";
      html += "<thead><tr><th>ID</th><th>Name</th><th>Position</th></tr></thead><tbody>";
      while (stmt.step()) {
        const row = stmt.getAsObject();
        html += `<tr>
                   <td>${row.id}</td>
                   <td>${row.name}</td>
                   <td>${row.position}</td>
                 </tr>`;
      }
      html += "</tbody></table>";

      document.getElementById("results").innerHTML = html;

      // 7) 자원 정리 (필요시)
      stmt.free();   // prepare statement 해제
      // db.close(); // 예: 작업 끝난 후 DB를 닫을 수도 있음
    })();
  </script>
</body>
</html>
