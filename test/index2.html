<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>SQL.js 테스트 (WASM base64 외부 js)</title>
</head>
<body>
  <h1>sql.js + WASM Base64 (별도 js)</h1>
  <p>서버 없이 file:// 로 열어도 CORS 문제가 발생하지 않습니다.</p>

  <div id="results"></div>

  <!-- (1) sql-wasm.js: sql.js 배포본 -->
  <script src="sql-wasm.js"></script>

  <!-- (2) base64 문자열을 전역변수로 담고 있는 파일 -->
  <script src="sql-wasm-b64.js"></script>

  <!-- (3) 실제 초기화 로직 -->
  <script>
    (async () => {
      // 1) initSqlJs() 호출 시, WASM 파일 경로 대신 data URL로
      const SQL = await initSqlJs({
        locateFile: file => {
          // file: "sql-wasm.wasm" (sql.js가 기본적으로 요구)
          // data URL로 반환
          return "data:application/wasm;base64," + window.WASM_BASE64.trim();
        }
      });

      // 2) 인메모리 DB 생성
      const db = new SQL.Database();

      // 3) 간단한 쿼리 실행
      db.run(`
        CREATE TABLE employees (
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          name TEXT,
          position TEXT
        );
      `);
      db.run(`
        INSERT INTO employees (name, position)
        VALUES ('Alice', 'Engineer'), ('Bob', 'Designer');
      `);

      const stmt = db.prepare("SELECT * FROM employees");
      let html = "<table border='1' cellpadding='4' style='border-collapse: collapse;'>";
      html += "<thead><tr><th>ID</th><th>Name</th><th>Position</th></tr></thead><tbody>";
      while (stmt.step()) {
        const row = stmt.getAsObject();
        html += `
          <tr>
            <td>${row.id}</td>
            <td>${row.name}</td>
            <td>${row.position}</td>
          </tr>
        `;
      }
      html += "</tbody></table>";

      document.getElementById("results").innerHTML = html;

      stmt.free();
      // db.close(); // 필요시
    })();
  </script>
</body>
</html>
